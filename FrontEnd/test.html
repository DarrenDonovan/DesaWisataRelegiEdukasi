<!DOCTYPE html>
<html lang="en">
  <head>
    <title>css transform 3d cube panorama demo</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  </head>
  <body>
    <div id="map" style="width: 100%; height: 500px"></div>
  </body>
  <script>
    var map = L.map("map").setView([0, 0], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors",
    }).addTo(map);

    function onLocationFound(e) {
      var userMarker = L.marker(e.latlng)
        .addTo(map)
        .bindPopup("Lokasi Anda")
        .openPopup();

      console.log("Lokasi pengguna:", e.latlng); // Debugging

      // **Tentukan lokasi tujuan secara manual**
      var destination = [-7.8014, 110.3649]; // Contoh: Kota Yogyakarta
      console.log("Lokasi tujuan:", destination); // Debugging

      getRoute(e.latlng, destination);
    }

    function onLocationError(e) {
      alert("Lokasi tidak dapat ditemukan");
    }

    map.locate({ setView: true, maxZoom: 16 });
    map.on("locationfound", onLocationFound);
    map.on("locationerror", onLocationError);

    function getRoute(start, end) {
      var osrmRoute = `https://router.project-osrm.org/route/v1/driving/${start.lng},${start.lat};${end[1]},${end[0]}?overview=full&geometries=geojson`;

      console.log("Fetching route from OSRM:", osrmRoute); // Debugging

      fetch(osrmRoute)
        .then((response) => response.json())
        .then((data) => {
          if (!data.routes || data.routes.length === 0) {
            console.error("Tidak ada rute yang ditemukan.");
            return;
          }

          var routeCoords = data.routes[0].geometry.coordinates.map((coord) => [
            coord[1],
            coord[0],
          ]);
          var routeLine = L.polyline(routeCoords, { color: "blue" }).addTo(map);
          map.fitBounds(routeLine.getBounds());

          console.log("Rute berhasil digambar:", routeCoords); // Debugging
        })
        .catch((error) => console.error("Error fetching route:", error));
    }
  </script>
</html>
